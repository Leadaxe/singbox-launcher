# Чеклист для ручного тестирования сохранения комментариев

## Подготовка

1. ✅ Убедиться, что тесты проходят
2. ✅ Создать бэкап существующего config.json (если есть)
3. ✅ Подготовить тестовый шаблон с комментариями

## Тестирование загрузки шаблона

### Проверка сохранения комментариев в секциях

1. **Секция log**
   - [ ] Открыть `bin/config_template.json`
   - [ ] Проверить наличие комментариев в секции `log`
   - [ ] Создать конфиг через Wizard
   - [ ] Проверить, что все комментарии из секции `log` сохранились в финальном конфиге
   - [ ] Проверить позиции комментариев (они должны быть на тех же местах)

2. **Секция dns**
   - [ ] Проверить комментарии в секции `dns` в шаблоне
   - [ ] Создать конфиг через Wizard
   - [ ] Проверить сохранение всех комментариев в секции `dns`
   - [ ] Проверить комментарии к серверам DNS и правилам

3. **Секция inbounds**
   - [ ] Проверить комментарии в секции `inbounds` (особенно для TUN интерфейса)
   - [ ] Создать конфиг через Wizard
   - [ ] Проверить сохранение всех комментариев к параметрам TUN
   - [ ] Проверить комментарии к `route_exclude_address`

4. **Секция experimental**
   - [ ] Проверить комментарии в секции `experimental`
   - [ ] Создать конфиг через Wizard
   - [ ] Проверить сохранение комментариев к `cache_file` и другим параметрам

## Тестирование route секции

### Проверка @SelectableRule блоков

1. **Блоки остаются в тексте**
   - [ ] Проверить, что @SelectableRule блоки присутствуют в финальном конфиге
   - [ ] Проверить, что метаданные (@label, @description) сохранились в блоках

2. **Обработка включенных правил**
   - [ ] Включить правило в Wizard
   - [ ] Проверить, что JSON правило после блока обновлен с учетом выбранного outbound
   - [ ] Проверить, что блок остался в тексте

3. **Обработка выключенных правил**
   - [ ] Выключить правило в Wizard
   - [ ] Проверить, что в блоке добавлен @default
   - [ ] Проверить, что JSON правило после блока удален
   - [ ] Проверить, что блок остался в тексте

4. **Пользовательские правила**
   - [ ] Добавить пользовательское правило
   - [ ] Проверить, что оно добавлено в массив rules
   - [ ] Проверить, что комментарии из шаблона не потерялись

5. **Final outbound**
   - [ ] Изменить final outbound в Wizard
   - [ ] Проверить, что значение обновилось в финальном конфиге
   - [ ] Проверить, что комментарии сохранились

## Тестирование сохранения конфига

1. **Замена secret**
   - [ ] Создать конфиг с `CHANGE_THIS_TO_YOUR_SECRET_TOKEN`
   - [ ] Сохранить конфиг
   - [ ] Проверить, что secret заменен на случайный
   - [ ] Проверить, что все комментарии сохранились после замены

2. **Обновление существующего secret**
   - [ ] Загрузить конфиг с существующим secret
   - [ ] Сохранить конфиг
   - [ ] Проверить, что secret обновлен
   - [ ] Проверить, что комментарии сохранились

## Тестирование валидности конфига

1. **JSONC валидность**
   - [ ] Проверить, что финальный конфиг валиден JSONC
   - [ ] Использовать `jsonc.Valid` или парсер для проверки

2. **Парсинг sing-box**
   - [ ] Попробовать загрузить конфиг в sing-box
   - [ ] Проверить, что sing-box корректно парсит конфиг
   - [ ] Проверить, что нет ошибок парсинга

## Тестирование edge cases

1. **Конфиг без комментариев**
   - [ ] Создать конфиг из шаблона без комментариев
   - [ ] Проверить, что конфиг работает корректно

2. **Конфиг с множеством комментариев**
   - [ ] Использовать `config.example.json` (если есть)
   - [ ] Создать конфиг через Wizard
   - [ ] Проверить сохранение всех комментариев

3. **Конфиг с @SelectableRule блоками без правил**
   - [ ] Создать конфиг с блоками, но без правил в UI
   - [ ] Проверить, что блоки сохранились

4. **Trailing commas**
   - [ ] Проверить, что trailing commas удаляются корректно
   - [ ] Проверить, что конфиг валиден после удаления

## Проверка производительности

1. **Большой конфиг**
   - [ ] Создать конфиг с большим количеством outbounds
   - [ ] Проверить время генерации
   - [ ] Проверить, что комментарии сохранились

## Сравнение с исходным шаблоном

1. **Визуальное сравнение**
   - [ ] Открыть исходный шаблон и финальный конфиг рядом
   - [ ] Сравнить комментарии в каждой секции
   - [ ] Убедиться, что все комментарии на месте

2. **Подсчет комментариев**
   - [ ] Подсчитать комментарии в исходном шаблоне
   - [ ] Подсчитать комментарии в финальном конфиге
   - [ ] Убедиться, что количество совпадает (или близко)

## Известные проблемы для проверки

1. **Trailing commas в route секции**
   - [ ] Проверить, что trailing commas удаляются корректно
   - [ ] Проверить различные варианты форматирования

2. **Пустые строки перед ]**
   - [ ] Проверить, что пустые строки удаляются корректно
   - [ ] Проверить форматирование массива rules

## Результаты тестирования

### Успешные тесты
- [ ] Загрузка шаблона с комментариями
- [ ] Сохранение комментариев в секциях log, dns, inbounds, experimental
- [ ] Обработка @SelectableRule блоков
- [ ] Замена secret с сохранением комментариев
- [ ] Валидность JSONC
- [ ] Парсинг sing-box

### Найденные проблемы
- [ ] Записать найденные проблемы здесь

### Рекомендации
- [ ] Записать рекомендации по улучшению здесь

